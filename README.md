# Для проверки работы вам потребуется установить:
- Ubuntu 22
- Ansible 2.13.5
- Oracle VirtualBox 7.0
- Vagrant Vagrant 2.3.2

Если по команде vagrant up из основной директории проекта выдает ошибку образа, требуется скачать и установить образ, аналогичный Centos 7 -  https://app.vagrantup.com/centos/boxes/7
Также трубется заменить название образа, которое вы указали при загрузке (команда vagrant box add --name ИМЯ_ОБРАЗА URL or Address to Image) в файле Vagrantfile проекта.

      Vagrant.configure("2") do |config|
         config.vm.box = "ИМЯ_ОБРАЗА"

------------------------------------------------------------

# Задача. LDAP
1. Установить FreeIPA;
2. Написать Ansible playbook для конфигурации клиента;
3. Firewall должен быть включен на сервере и на клиенте.

# Решение

Примечание. Не просто же так предупреждали, что сценарий развертывания freeIPA на ansible довольно непредсказуемый. Плюсуем к этому требовательность к ресурсам и относительную неспешность. В среднем конфигурирование freeIPA приходилось ожидать около 5 минут. В случае проблем, к примеру, неправильной конфигурации - увеличивалось до 8 минут. А когда были проблемы с настройками сети - до 15 минут. Это всё было удручающе долго. Поэтому времени на всякие красивости не хватило. Всё по спартански!

Запуск стенда:

            $ vagrant up

Разрешаю порты для сервера:

                TCP Ports:
                  * 80, 443: HTTP/HTTPS
                  * 389, 636: LDAP/LDAPS
                  * 88, 464: kerberos
                UDP Ports:
                  * 88, 464: kerberos
                  * 123: ntp

Для сервера и клиента задаю временной пояс и ставлю пакеты контроля за временем. Не забываю про firewall
По итогу поднимаются 2 виртуальные машины: 
Server 192.168.56.10
Client 192.168.56.20

После отработки сценариев, открыть на локальной машине файл /etc/hosts
И добавить строчку: 

            192.168.56.10 ipaserver.raibeart.loc
            
Открыть браузер и перейти по адресу 

            https://ipaserver.raibeart.loc

![alt text](screenshots/pic1.png "")

Ввести в поля авторизации логин и пароль: 

           admin
           ZZ12zz34

Мы успешно авторизовались:
![alt text](screenshots/pic2.png "")

Также мы видим, что наш клиентский сценарий отработал и у нас появилась еще одна запись
![alt text](screenshots/pic3.png "")


Проверка, что авторизация клиента идет по ключу:
Зайти на клиентскую машину:  

           $ vagrant ssh ipaclient

Повысить права до root:

           $ sudo -i

Переключимся на тестового пользователя: 

           $ su Agent007

Подключиться к серверу по ключу 

           $ ssh ipaserver.raibeart.loc -v

С дополнительной информацией видно, что авторизация осуществляется по сгенерированному ключу

